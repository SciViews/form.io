---
title: "Ideas for the form.io R package - tests"
output: html_notebook
---

Among the `SciViews` R packages, `form.io` would be devoted to the input and especially output of textual data (input of tabular data being managed by `data.io`). Here, we reuse existing functons like `knitr::kable()` or `pander::pander()`, but we make trhem simpler to use and working in all cases being:

- At the R console,
- Inside an R Markdown/Notebook inline area just beneath a chunk,
- In a knitted R markdoiwn file, HTML format,
- Idem, but with a LaTeX format.

Both `knitr` with `kable()`, and trhe `kableExtra` functions, and `pander` with the `pander()` function do that. However, the syntax is not always easy, and code eventually differ depending on the situation among the four possible ones here above.

Moreover, none of `kable()` or `pander()` functions allow for the *translation* of the result in a different language, and they also do not take into account attributes like `label` or `units` (see the `data.io` package).

So, we experiment with a new function, `form()` that creates formatted tables or other objects (lists, ...) to be directly integrated in an R Markdown document, or to be used at the R Console. The current experimental code is in a gist: "https://go.sciviews.org/form". So, it is easy to download and source. Of course, we will move to a real R package very soon.


```{r}
SciViews::R
options(data.io_lang = "FR") # Same language option is used by form.io::form()
dir.create("../R", showWarnings = FALSE)
if (!file.exists("../R/form.io.R")) # Note: delete this file to regenerate cache
  download.file("https://go.sciviews.org/form", "../R/form.io.R")
if (!"form.io" %in% search())
  attach(list(), pos = 2L, name = "form.io")
#source("../R/form.io.R")
do.call(source, list(file = "../R/form.io.R", local = TRUE),
  envir = as.environment("form.io"))
```

```{r}
# Test
trees <- read("trees", package = "datasets")
lm_1 <- lm(data = trees, volume ~ .)
form(trees)
form(head(trees), data = trees) # Try without data =
form(anova(lm_1), data = trees)
```


### Using `form()`

`pander::pander()` works well with knitted documents, but it outputs text only in R notebooks. The `form()` function is solving this problem, while still outputing a textual markdown version at the R console.

```{r}
trees <- read("trees", package = "datasets")

lm_1 <- lm(data = trees, volume ~ .)
lm_2 <- lm( data = trees, volume ~ I(diameter^2))
```

- Data frame\ :

```{r}
form(trees, caption = "Mesure de cerisiers noirs")
# Equivalent to:
#form(trees, caption = "Mesure de cerisiers noirs", labels = TRUE, units = TRUE)
```

Any manipulation of a data frame with labels and units makes it loose its attributes, ... but the `data =` argument is there to look at original data set for these attributes\ :

```{r}
form(head(trees))
form(head(trees), data = trees)
```


- Objects `data.table`\ :

```{r}
library(data.table)
trees_dt <- as.data.table(trees)
class(trees_dt)
form(trees_dt)
```


- Object `lm`\ :

```{r}
form(lm_1)
```

- Summary of `lm`\ :

```{r}
form(summary(lm_1), caption = "Régression avec toutes les variables",
  covariate.labels = c("Ordonnée à l'origine", "Diamètre à 1,4m", "Hauteur"))
```

- Anova of `lm`\ :

```{r}
form(anova(lm_1), data = trees, caption = "ANOVA de ma régression linéaire")
```


- Lists\ :

```{r}
form(list(a = 1:3, b = TRUE, c = LETTERS))
```


- Objects `ts`\ :

```{r}
form(nottem, caption = "températures à Notthingam")
```


- Unknown object type (coerced to a list with a warning)\ :

```{r}
form(structure(list(a = 1, b = 3:5), class = "new_oject"))
```



### Using `kable()`

Note: the `kable()` functions are not integrated yet into `form()` for the moment!

The `kable()` function is standard in `knitr`. Moreover, the `kableExtra` package allows for further configuration of the output.

```{r}
#options( knitr.table.format = "markdown")
knitr::kable(trees, caption = "The `trees` dataset")
#kableExtra::xtable2kable(xtable::xtable(linear.1))
```

```{r}
knitr::kable(broom::glance(lm_1)[, c(1, 3, 5, 8, 11)])
```

```{r}
knitr::kable(broom::tidy(lm_1), caption = "Tableau des coefficients")
```


### Using `stargazer`

Not good! But we may considering to fix these...

```{r}
stargazer::stargazer(trees, type = "text")
stargazer::stargazer(trees, type = "latex")
stargazer::stargazer(lm_1, type = "text")
```
